# Billing API Documentation

paths:
  /api/billing/plans:
    get:
      tags:
        - Billing
      summary: Get available plans
      description: List all subscription plans
      responses:
        '200':
          description: List of plans
          content:
            application/json:
              schema:
                type: object
                properties:
                  plans:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: professional
                        name:
                          type: string
                          example: Professional
                        price:
                          type: number
                          example: 49
                        interval:
                          type: string
                          enum: [month, year]
                        features:
                          type: array
                          items:
                            type: string
                        limits:
                          type: object
                          properties:
                            bots:
                              type: integer
                            messages:
                              type: integer
                            team_members:
                              type: integer

  /api/billing/subscription:
    get:
      tags:
        - Billing
      summary: Get subscription
      description: Get current organization subscription
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Subscription details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  subscription:
                    $ref: '#/components/schemas/Subscription'

  /api/billing/subscribe:
    post:
      tags:
        - Billing
      summary: Subscribe to plan
      description: Create or update subscription
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - plan
              properties:
                plan:
                  type: string
                  enum: [starter, professional, enterprise]
                payment_method_id:
                  type: string
                  description: Stripe payment method ID
      responses:
        '200':
          description: Subscription created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  subscription:
                    $ref: '#/components/schemas/Subscription'
                  clientSecret:
                    type: string
                    description: Stripe client secret for 3DS

  /api/billing/cancel:
    post:
      tags:
        - Billing
      summary: Cancel subscription
      description: Cancel current subscription
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                immediately:
                  type: boolean
                  default: false
      responses:
        '200':
          description: Subscription cancelled

  /api/billing/usage:
    get:
      tags:
        - Billing
      summary: Get usage
      description: Get organization usage statistics
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Usage statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  usage:
                    type: object
                    properties:
                      bots:
                        type: object
                        properties:
                          current:
                            type: integer
                          limit:
                            type: integer
                          percentage:
                            type: number
                      messages:
                        type: object
                        properties:
                          current:
                            type: integer
                          limit:
                            type: integer
                          percentage:
                            type: number
                      apiCalls:
                        type: object
                        properties:
                          current:
                            type: integer
                          limit:
                            type: integer
                          percentage:
                            type: number

  /api/billing/invoices:
    get:
      tags:
        - Billing
      summary: List invoices
      description: Get billing invoices
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: List of invoices
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  invoices:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        amount:
                          type: number
                        status:
                          type: string
                        created:
                          type: string
                          format: date-time
                        pdf_url:
                          type: string

  /api/billing/payment-methods:
    get:
      tags:
        - Billing
      summary: List payment methods
      description: Get saved payment methods
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Payment methods
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  paymentMethods:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        type:
                          type: string
                        card:
                          type: object
                          properties:
                            brand:
                              type: string
                            last4:
                              type: string
                            exp_month:
                              type: integer
                            exp_year:
                              type: integer
                        isDefault:
                          type: boolean

    post:
      tags:
        - Billing
      summary: Add payment method
      description: Add a new payment method
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - payment_method_id
              properties:
                payment_method_id:
                  type: string
                set_default:
                  type: boolean
                  default: true
      responses:
        '200':
          description: Payment method added

  /api/billing/webhook:
    post:
      tags:
        - Billing
      summary: Stripe webhook
      description: Handle Stripe webhook events
      requestBody:
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Webhook processed
